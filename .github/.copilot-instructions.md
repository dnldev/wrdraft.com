# Copilot Instructions for WR Draft Playbook

This document provides a comprehensive guide for the Copilot agent to work effectively on this repository. **Always
trust these instructions as the primary source of truth.** Only resort to searching the codebase if these instructions
are incomplete or found to be in error for a specific task.

## 1. High-Level Details

### Repository Summary

This repository contains a data-driven strategy tool and playbook for the game League of Legends: Wild Rift. The
application's main feature is an intelligent "Matchup Calculator" that helps players make optimal champion selections
during a live draft.

### Repository Information

- **Project Type:** Web Application (Single Page App)
- **Primary Language:** TypeScript (strict mode)
- **Framework:** Next.js 16 (App Router)
- **UI Library:** `@heroui/react`
- **Styling:** Tailwind CSS v4
- **Database:** Upstash Redis (via Vercel integration)
- **SDK:** `@upstash/redis`

## 2. Build, Run, and Validate Instructions

### Environment Setup (Required Precondition)

1. **Node.js:** You must use Node.js version 22.x or later.
2. **Upstash:** Create a Redis database via the Upstash integration in the Vercel dashboard and link it to this project.
   This will automatically add project-specific environment variables (e.g., `WR_KV_...`) to your Vercel project
   settings.
3. **Environment Variables:** Create a file named `.env.development.local` in the project root by running the following
   command. This will sync the secrets from Vercel to your local machine.
   - **Command:** `npx vercel env pull .env.development.local`
   - The file must contain `WR_KV_REST_API_URL` and `WR_KV_REST_API_TOKEN`.
   - **Common Failure:** The application will fail to start or seed if this file is missing or the variables are
     invalid.

### Step-by-Step Command Sequence

1. **Bootstrap (Installation):** `npm ci`
2. **Database Seeding:**
   - **Command:** `npm run db:seed`
   - **Purpose:** Seeds or updates the static game data (champions, matrices, etc.) in the Upstash database. This is a
     **non-destructive** operation and is safe to run on a database with existing user data.
   - **Note:** This must be run after the initial setup and any time the static data in the `/data` directory is
     changed.

3. **Run (Development Server):** `npm run dev`
4. **Validation:** `npm run format:check`, `npm run lint`, `npm test`. These must pass.
5. **Build:** `npm run build` (For local testing). Vercel uses `npm run vercel-build`.

## 3. Project Layout and Architecture

- `app/`: Next.js App Router. `page.tsx` is dynamic.
- `lib/upstash.ts`: **Centralized Upstash Redis client instance**. It uses a lazy-initialization pattern and reads the
  Vercel-provided, project-prefixed environment variables.
- `lib/data-fetching.ts`: Server-side data fetching for `page.tsx`.
- `app/api/drafts/route.ts`: API for saving/deleting match history.
- `scripts/seed.ts`: Non-destructive seeding script that uses the central Upstash client.

### Architectural Principles to Enforce

1. **Database Interaction:** All server-side database operations **must** use the official `@upstash/redis` SDK via the
   `getKvClient()` function in `lib/upstash.ts`.
2. **Data Flow:** `app/page.tsx` uses `getPlaybookData()` for all initial data. The page is marked
   `export const dynamic = "force-dynamic";` to prevent stale data on Vercel.
