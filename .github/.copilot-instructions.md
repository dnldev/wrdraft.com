# Copilot Instructions for WR Draft Playbook

This document provides a comprehensive guide for the Copilot agent to work effectively on this repository. **Always
trust these instructions as the primary source of truth.** Only resort to searching the codebase if these instructions
are incomplete or found to be in error for a specific task.

## 1. High-Level Details

### Repository Summary

This repository contains a data-driven strategy tool and playbook for the game League of Legends: Wild Rift. The
application's main feature is an intelligent "Matchup Calculator" that helps players make optimal champion selections
during a live draft.

The core goals of this project are, in order of priority:

1. **Performance:** The UI must be extremely fast and responsive, especially during user interactions within the
   calculator.
2. **Low Code Complexity:** The architecture must be maintainable, testable, and easy to understand.
3. **Strategic Accuracy:** The recommendations must be based on sound, well-structured data.

### Repository Information

- **Project Type:** Web Application (Single Page App)
- **Size:** Small to Medium
- **Primary Language:** TypeScript (strict mode)
- **Framework:** Next.js 16 (App Router)
- **UI Library:** `@heroui/react`
- **Styling:** Tailwind CSS v4 with the HeroUI plugin.
- **Target Runtime:** Node.js v22.x
- **Database:** Vercel KV (Redis)

## 2. Build, Run, and Validate Instructions

Follow these steps precisely to set up the development environment and validate changes.

### Environment Setup (Required Precondition)

1. **Node.js:** You must use Node.js version 22.x or later.
2. **Environment Variables:** Create a file named `.env.development.local` in the root of the project. This file is \*
   \*required\*\* to run the application. It must contain the following variable:
   ```
   REDIS_URL="your_redis_connection_url_here"
   ```
   **Common Failure:** The application will fail to start (`npm run dev`) or build (`npm run build`) if this file is
   missing or the `REDIS_URL` is invalid.

### Step-by-Step Command Sequence

1. **Bootstrap (Installation):**
   - **Command:** `npm ci`
   - **Purpose:** Installs all dependencies based on the `package-lock.json` file.
   - **Note:** **Always run `npm ci` after cloning the repository or after pulling changes that modify `package.json`.
     ** This ensures a deterministic build environment and is the standard for this project.

2. **Database Seeding:**
   - **Command:** `npm run db:seed`
   - **Purpose:** Clears the Redis database and populates it with all static game data from the `/data` directory.
   - **Note:** This step is **critical**. The application will not function without data in Redis. It must be run after
     the initial setup. The `npm run build` command runs this automatically, but for development (`npm run dev`), you
     must run it manually at least once.

3. **Run (Development Server):**
   - **Command:** `npm run dev`
   - **Purpose:** Starts the Next.js development server.
   - **Preconditions:** `npm ci` must have been run, and the `.env.development.local` file must be correctly
     configured.
   - **Output:** The application will be available at `http://localhost:3000`.

4. **Linting & Formatting:**
   - **Lint Command:** `npm run lint`
   - **Format Check Command:** `npm run format:check`
   - **Purpose:** These commands check for code quality and style issues. They are part of the CI pipeline and **must
     pass** before any code is committed.

5. **Testing:**
   - **Command:** `npm test`
   - **Purpose:** Runs the entire Jest test suite, focusing on business logic and hooks.
   - **Note:** This is a mandatory CI check.

6. **Build (Production):**
   - **Command:** `npm run build`
   - **Purpose:** Creates a production-ready build of the application.
   - **Note:** This command automatically runs `npm run db:seed` before building.

## 3. Project Layout and Architecture

### Directory Structure

- `app/`: Main Next.js App Router directory.
  - `page.tsx`: The single entry point for the application. It performs the initial server-side data fetch using
    `getPlaybookData()`.
  - `layout.tsx`: The root layout.
  - `providers.tsx`: Client-side providers for theming (`next-themes`) and the UI library (`@heroui/react`).
- `components/`: All React components, organized by feature.
  - `views.ts`: Exports `React.memo`-wrapped versions of the main view components for performance. New views must
    follow this pattern.
- `hooks/`: Custom React hooks for stateful logic.
  - **Architectural Pattern:** Logic is strictly separated. `useBanPhase.ts` handles the ban UI state, while
    `useMatchupCalculator.ts` handles the recommendation logic.
- `lib/`: Core, non-React business logic and utilities.
  - `calculator.ts`: The "engine" of the application. Contains the scoring and recommendation algorithms. **Changes
    here require corresponding updates to `lib/calculator.spec.ts`.**
  - `data-fetching.ts`: Contains `getPlaybookData()`, the primary server-side data fetching function.
- `data/`: The single source of truth for all static data (champions, synergies, matrices).
  - `data-manifest.ts`: Central file that maps Redis keys to data objects for the seeding script.
- `scripts/`: Node.js scripts for tasks like seeding the database.

### Key Configuration Files

- `.github/workflows/ci.yml`: Defines the GitHub Actions CI pipeline.
- `.husky/pre-commit`: Sets up the pre-commit hook to run `lint-staged`.
- `eslint.config.mjs`: ESLint configuration, including SonarJS and Unicorn rules.
- `jest.config.js`: Jest test runner configuration.
- `tailwind.config.ts`: Tailwind CSS configuration, including all custom HeroUI themes.

### Continuous Integration (CI) & Validation

All pull requests are subject to a CI pipeline defined in `.github/workflows/ci.yml`. The agent's changes **must pass
all of these checks.** The CI runs: `npm ci`, `npm run format:check`, `npm run lint`, `npm test`.

### Architectural Principles to Enforce

1. **Performance is Non-Negotiable:**
   - **Aggressively Prevent Re-renders:** State changes must be scoped to the smallest possible part of the component
     tree.
   - **State Colocation:** State must live as close as possible to the components that use it. For example, all state
     for the calculator is managed within `MatchupCalculator.tsx` and its custom hooks to prevent re-rendering the main
     navigation or footer.
   - **`React.memo` is Mandatory:** Use `React.memo` on any component passed as a prop (e.g., the main "view"
     components in `app/page.tsx`) or rendered in a list.
   - **`useMemo` for Derived State:** All expensive computations based on props or state (like filtering lists or
     calculating recommendation `results`) must be wrapped in `useMemo`.
   - **`useDeferredValue` Over `useDebounce`:** For computationally intensive tasks that respond to user input (like
     the recommendation calculations), `useDeferredValue` must be used to keep the UI responsive.
   - **Image Optimization:** All images **must** use the `<Image>` component from `next/image` for automatic
     optimization. Use the `priority` prop for critical, above-the-fold images.

2. **Data Flow is Server-First:**
   - The `app/page.tsx` component uses a single, manifest-driven function, `getPlaybookData()`, to load all necessary
     data from Redis in one batch operation. This pattern is fundamental.
   - **Do not introduce client-side `useEffect` with `fetch`** for data that is already available from the server.

3. **Strive for Low Cognitive Complexity:**
   - **Separate Concerns with Custom Hooks:** Encapsulate distinct sets of logic into their own custom hooks (e.g.,
     `useBanPhase.ts` vs `useMatchupCalculator.ts`).
   - **Apply Design Patterns:** Actively look for complex conditional logic (`if/else` chains, `switch` statements). If
     a component or hook's behavior changes drastically based on a 'mode' or 'type', suggest refactoring it using a
     design pattern. The **Strategy Pattern** is a preferred solution in this codebase.
   - **Extract Logic into `lib`:** Pure, complex business logic (like the scoring algorithm) must be extracted into
     utility functions in the `/lib` directory and have corresponding unit tests.
   - **Prefer Explicit Loops for Readability:** Prefer explicit `for...of` loops over `Array.prototype.reduce()`. Our
     linter (`unicorn/no-array-reduce`) enforces this.

4. **Data Structures & Logic Engine:**
   - The core of the application is the "calculator engine" located in `lib/calculator.ts`.
   - It consumes `synergyMatrix`, `counterMatrix`, and `categoryData` to produce its scores.
   - Any changes to the scoring logic must be reflected in `lib/calculator.ts` and be accompanied by updated Jest tests
     in `lib/calculator.spec.ts`.

### Code Style and Conventions

- **JSDoc Comments:** All new functions, hooks, and components must have clear JSDoc comments. **Do not state the
  obvious.** A comment like `/** The MatchupCalculator component */` is useless. Explain the _purpose_ and
  _responsibility_ of the code.
- **File Naming:**
  - Components and Hooks: `PascalCase.tsx` (e.g., `MatchupCalculator.tsx`, `useBanPhase.ts`).
  - Utilities, Data, and Config files: `kebab-case.ts` (e.g., `data-fetching.ts`, `synergyData.ts`).
  - Test files: `*.spec.ts`.
- **Styling Conventions:** Use semantic theme colors from HeroUI (e.g., `bg-primary`, `text-danger`) instead of raw
  Tailwind colors (e.g., `bg-red-500`).
- **Commit Messages:** Follow the Conventional Commits specification (e.g., `feat(calculator): ...`,
  `fix(styling): ...`).

### Testing Philosophy

- **Test the Logic, Not the Implementation:** Focus tests on the "engine" of the application.
- **High-Priority Test Files:** `lib/**/*.ts` and `hooks/**/*.ts` must have thorough unit tests for their complex logic.
- **Low-Priority Test Files:** Do not add tests for simple presentational components that just render props and have no
  internal logic.

### What to Avoid

- Do not suggest alternative UI libraries; we are committed to `@heroui/react`.
- Do not suggest alternative data fetching patterns for the main page data.
- Do not suggest removing or altering the established CI/CD pipeline.
- Do not suggest replacing `for...of` loops with `Array.prototype.reduce()`.
